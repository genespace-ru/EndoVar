snvs:
  type: table
  displayName: SNV
  order: '30'
  primaryKey: ID
  scheme:
    columns:
    - ID:
        type: KEYTYPE
        autoIncrement: true
        primaryKey: true
        doc: SNV internal identifier.
    - V:
        type: VARCHAR(1000)
        doc: Variant
    - C:
        type: VARCHAR(100)
        doc: Chromosome number
    - P:
        type: VARCHAR(100)
        doc: SNV position
    - R:
        type: VARCHAR(1000)
        doc: Reference base
    - A:
        type: VARCHAR(1000)
        doc: Alternative base
    - Pa:
        type: VARCHAR(50)
        canBeNull: true
        doc: Algorithmically predicted pathogenicity level
    - GAF:
        type: VARCHAR(20)
        canBeNull: true
        doc: gnomAD allele frequency
    - Glt:
        type: VARCHAR(20)
        canBeNull: true
        doc: gnomaAD number of homozygotes
    - Rq:
        type: VARCHAR(20)
        canBeNull: true
        doc: RUSeq allele frequency
    - CID:
        type: VARCHAR(20)
        canBeNull: true
        doc: variant ID in ClinVar database    
    - Cif:
        type: VARCHAR(100)
        canBeNull: true
        doc: Clinical interpretation of the variant by submitters
    - OM:
        type: VARCHAR(20)
        canBeNull: true
        doc: OMIM ID
    - VCT:
        type: VARCHAR(20)
        canBeNull: true
        doc: Variant impact on protein       
    - SAI:
        type: VARCHAR(20)
        canBeNull: true
        doc: Predicted effect on splicing by SpliceAI tool
    - MVM:
        type: VARCHAR(20)
        canBeNull: true
        doc: MetaSVM prediction
    - BDl:
        type: VARCHAR(20)
        canBeNull: true
        doc: BayesDel prediction
    - CD:
        type: VARCHAR(20)
        canBeNull: true
        doc: CADD_phred score

  queries:

    - '*** Selection view ***':
        type: 1D
        roles: '@AllRoles'
        code: |
            SELECT 
                ID AS "Code",
                C AS "CHR",
                P AS "Position",
                R AS "REF",
                A AS "ALT",
                G AS "Gene"
            FROM snvs
            ORDER BY C

    - All records:
        type: 1D
        roles: '@Guest'
        layout: '{"topForm":"SNVFilter", "quickType":"select"}'
        operations:
        - SNVFilter
        code: |
            SELECT
                s.V AS "Variant;<quick visible='true' />",
                s.C AS "CHR",
                s.P AS "Position",
                s.R AS "REF",
                s.A AS "ALT",
                t.G AS "Gene",
                t.VCT AS "VEP_IMPACT;<quick visible='true' />",
                t.VC AS "VEP_consequence;<quick visible='true' />",
                t.Exon AS "Exon;<quick visible='true' />",
                t.aac AS "Aminoacid change;<quick visible='true' />",
                t.cdnac AS "cDNA change;<quick visible='true' />",
                t.Pa AS "Pathogenicity;<quick visible='true' />",
                t.GAF AS "GNOMAD3_AF;<quick visible='true' />",
                t.Glt AS "GNOMAD3_nhomalt;<quick visible='true' />",
                t.OMphe AS "OMIM_phenotype;<quick visible='true' />",
                t.SAI AS "SPLICE_AI;<quick visible='true' />",
                t.MVM AS "Meta_SVM;<quick visible='true' />",
                t.BDl AS "BayesDel;<quick visible='true' />",
                t.CD AS "CADD;<quick visible='true' />"
            FROM snvs s
            LEFT JOIN tiers t ON s.V = t.V 
            WHERE (1=1)
            <if parameter="Variant">
              AND V LIKE '<parameter:Variant/>%'
            </if>  
            <if parameter="gene">
              AND t.G = '<parameter:gene/>'
            </if>        

  operations:
  - SNVFilter:
      type: Groovy
      roles: '@AllRoles'
      file: operations.filters.SNVFilter.groovy
