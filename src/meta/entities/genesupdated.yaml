genesupdated:
  type: table
  displayName: Genes NEW
  order: '80'
  primaryKey: ID
  scheme:
    columns:
    - ID:
        type: KEYTYPE
        autoIncrement: true
        primaryKey: true
        doc: Gene internal identifier.
    - ncbi_gene_ID:
        type: VARCHAR(20)
        doc: NCBI gene ID
    - HGNC:
        type: VARCHAR(20)
        doc: The HGNC approved gene symbol.
    - name:
        type: VARCHAR(100)
        doc: Gene name from HGNC.
    - summary:
        type: VARCHAR(1900)
        canBeNull: true
        doc: extract of gene summary texts for genes that have them
    - ensembl_gene_id:
        type: VARCHAR(20)
        canBeNull: true
        doc: Ensembl gene ID
    - refseq_accession:
        type: VARCHAR(20)
        canBeNull: true
        doc: RefSeq nucleotide accession(s)
    - uniprot_ids:
        type: VARCHAR(20)
        canBeNull: true
        doc: UniProt protein accession
    - omim_id:
        type: VARCHAR(20)
        canBeNull: true
        doc: Online Mendelian Inheritance in Man (OMIM) ID
    - orphanet:
        type: VARCHAR(20)
        canBeNull: true
        doc: Orphanet ID
    - mane_select:
        type: VARCHAR(50)
        canBeNull: true
        doc: NCBI and Ensembl transcript IDs/acessions including the version number for one high-quality representative transcript per protein-coding gene that is well-supported by experimental data and represents the biology of the gene. The IDs are delimited by |.
    - gain_CNV:
        type: INT
        doc: patients count with gain_CNV with gene   
    - loss_CNV:
        type: INT
        doc: patients count with loss_CNV with gene 
    - CNV_qty:
        type: INT
        doc: all patients count with CNV with gene 
    - CNV_patients_diagnosis:
        type: VARCHAR(10000)
        doc: list of patients diagnosis
  queries:

    - '*** Selection view ***':
        type: 1D
        roles: '@AllRoles'
        code: |
            SELECT 
                ID AS "Code",
                HGNC AS "Name"
            FROM genesupdated

    - All records:
        type: 1D
        roles: '@AllRoles'
        layout: '{"topForm":"GeneNEWFilter", "quickType":"select"}'
        operations:
        - GeneNEWFilter
        code: |
            SELECT 
                HGNC AS "HGNC",
                name, 
                summary AS "summary;<quick visible='true' />",
                ensembl_gene_id AS "Ensembl ID;<quick visible='true' />",
                refseq_accession AS "Refseq;<quick visible='true' />",
                uniprot_ids AS "Uniprot;<quick visible='true' />",
                omim_id AS "OMIM ID;<quick visible='true' />",
                orphanet AS "Orphanet;<quick visible='true' />", 
                mane_select AS "MANE_SELECT;<quick visible='true' />",
                gain_CNV AS "gain_CNV;<quick visible='true' />",
                loss_CNV AS "loss_CNV;<quick visible='true' />",
                CNV_qty AS "CNV_qty;<quick visible='true' />",
                CNV_patients_diagnosis AS "CNV_patient_diagnosis;<quick visible='true' />"

            FROM genesupdated gup
            WHERE (1=1)
            <if parameter="HGNC">
              AND gup.HGNC LIKE '<parameter:HGNC/>%'
            </if>
            <if parameter="Diagnosis">
              AND gup.CNV_patients_diagnosis LIKE '%<parameter:Diagnosis/>%'
            </if> 
            ORDER BY HGNC

#    - Card:
 #       layout: '{"tableBox":"gene", "mode":"named", "hideTitle":"true"}'
 #       invisible: true
  #      roles: "@AllRoles"
  #      code: |-
  #          SELECT
  #              ID AS "ID"
  #          FROM genes

 #   - Info:
 #       roles: "@AllRoles"
 #       layout: '{"tableBox":"geneInfo", "mode":"named", "filterUI":"no", "hideTitle":"true"}'
  #          SELECT
  #              name
   #         FROM genes

  operations:
  - GeneNEWFilter:
      type: Groovy
      roles: '@AllRoles'
      file: operations.filters.GeneNEWFilter.groovy

